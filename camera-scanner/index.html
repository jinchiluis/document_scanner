<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Simple Document Scanner</title>
  <style>
    body { 
      font-family: system-ui, sans-serif; 
      background: #1a1a1a; 
      margin: 0; 
      padding: 20px; 
      text-align: center; 
      color: #fff;
    }
    
    #camera-container { 
      position: relative; 
      display: inline-block; 
      max-width: 100%;
      background: #000;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    
    video { 
      width: 100%;
      max-width: 600px;
      display: block;
    }
    
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    #guide {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      height: 70%;
      border: 3px dashed rgba(255, 255, 255, 0.5);
      border-radius: 10px;
      pointer-events: none;
    }
    
    #guide::before {
      content: "Place document within frame";
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
      background: rgba(0, 0, 0, 0.7);
      padding: 5px 15px;
      border-radius: 20px;
    }
    
    .corner {
      position: absolute;
      width: 40px;
      height: 40px;
      border: 3px solid #00ff00;
    }
    
    .corner.tl { top: -3px; left: -3px; border-right: none; border-bottom: none; }
    .corner.tr { top: -3px; right: -3px; border-left: none; border-bottom: none; }
    .corner.bl { bottom: -3px; left: -3px; border-right: none; border-top: none; }
    .corner.br { bottom: -3px; right: -3px; border-left: none; border-top: none; }
    
    #controls {
      margin: 30px 0;
    }
    
    button {
      font-size: 1.1rem;
      padding: 15px 40px;
      margin: 0 10px;
      border-radius: 30px;
      border: none;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 20px rgba(0,0,0,0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button:disabled {
      background: #555;
      cursor: not-allowed;
      transform: none;
    }
    
    #flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 9999;
    }
    
    @keyframes flash {
      0% { opacity: 0; }
      50% { opacity: 0.8; }
      100% { opacity: 0; }
    }
    
    .flash-animation {
      animation: flash 0.3s ease-out;
    }
    
    #preview-container {
      margin: 30px auto;
      max-width: 600px;
      display: none;
    }
    
    #preview {
      width: 100%;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    
    #filters {
      margin: 20px 0;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }
    
    .filter-group {
      margin: 15px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    
    .filter-group label {
      min-width: 100px;
      text-align: right;
    }
    
    .filter-group input[type="range"] {
      width: 200px;
    }
    
    .filter-group span {
      min-width: 50px;
      text-align: left;
    }
    
    #status {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 30px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      border-radius: 30px;
      display: none;
      z-index: 1000;
    }
    
    #status.success {
      background: rgba(0, 200, 0, 0.9);
    }
    
    #status.error {
      background: rgba(200, 0, 0, 0.9);
    }
    
    #hidden-canvas {
      display: none;
    }
  </style>
</head>
<body>
  <h1>ðŸ“„ Document Scanner</h1>
  
  <div id="camera-container">
    <video id="video" autoplay playsinline muted></video>
    <div id="overlay">
      <div id="guide">
        <div class="corner tl"></div>
        <div class="corner tr"></div>
        <div class="corner bl"></div>
        <div class="corner br"></div>
      </div>
    </div>
  </div>
  
  <div id="controls">
    <button id="capture-btn" disabled>ðŸ“¸ Initializing...</button>
    <button id="save-btn" style="display:none;">ðŸ’¾ Save Document</button>
  </div>
  
  <div id="preview-container">
    <h3>Captured Document</h3>
    <canvas id="preview"></canvas>
    
    <div id="filters">
      <h4>Enhance Document</h4>
      
      <div class="filter-group">
        <label>Brightness:</label>
        <input type="range" id="brightness" min="50" max="150" value="100">
        <span id="brightness-val">100</span>
      </div>
      
      <div class="filter-group">
        <label>Contrast:</label>
        <input type="range" id="contrast" min="50" max="200" value="100">
        <span id="contrast-val">100</span>
      </div>
      
      <div class="filter-group">
        <label>Sharpness:</label>
        <input type="range" id="sharpness" min="0" max="100" value="0">
        <span id="sharpness-val">0</span>
      </div>
      
      <button onclick="resetFilters()">Reset</button>
      <button onclick="autoEnhance()">Auto Enhance</button>
    </div>
  </div>
  
  <canvas id="hidden-canvas"></canvas>
  <div id="flash"></div>
  <div id="status"></div>
  
  <script>
    // Elements
    const video = document.getElementById('video');
    const preview = document.getElementById('preview');
    const previewContainer = document.getElementById('preview-container');
    const hiddenCanvas = document.getElementById('hidden-canvas');
    const captureBtn = document.getElementById('capture-btn');
    const saveBtn = document.getElementById('save-btn');
    const flash = document.getElementById('flash');
    const status = document.getElementById('status');
    
    const hiddenCtx = hiddenCanvas.getContext('2d');
    const previewCtx = preview.getContext('2d');
    
    let stream = null;
    let originalImageData = null;
    
    // Filter controls
    const brightnessSlider = document.getElementById('brightness');
    const contrastSlider = document.getElementById('contrast');
    const sharpnessSlider = document.getElementById('sharpness');
    
    // Initialize camera
    async function initCamera() {
      try {
        stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: 'environment',
            width: { ideal: 1920 },
            height: { ideal: 1080 }
          }
        });
        
        video.srcObject = stream;
        
        video.onloadedmetadata = () => {
          video.play();
          captureBtn.disabled = false;
          captureBtn.textContent = 'ðŸ“¸ Capture Document';
          showStatus('Camera ready!', 'success');
        };
        
      } catch (err) {
        showStatus('Camera error: ' + err.message, 'error');
        captureBtn.textContent = 'Camera Failed';
      }
    }
    
    // Capture photo
    function captureDocument() {
      // Flash effect
      flash.classList.add('flash-animation');
      setTimeout(() => flash.classList.remove('flash-animation'), 300);
      
      // Set canvas size to video size
      hiddenCanvas.width = video.videoWidth;
      hiddenCanvas.height = video.videoHeight;
      preview.width = video.videoWidth;
      preview.height = video.videoHeight;
      
      // Draw video frame to canvas
      hiddenCtx.drawImage(video, 0, 0);
      
      // Store original image data
      originalImageData = hiddenCtx.getImageData(0, 0, hiddenCanvas.width, hiddenCanvas.height);
      
      // Show preview
      previewCtx.putImageData(originalImageData, 0, 0);
      previewContainer.style.display = 'block';
      saveBtn.style.display = 'inline-block';
      
      // Reset filters
      resetFilters();
      
      showStatus('Document captured!', 'success');
      
      // Scroll to preview
      previewContainer.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Apply filters
    function applyFilters() {
      if (!originalImageData) return;
      
      const brightness = parseInt(brightnessSlider.value);
      const contrast = parseInt(contrastSlider.value);
      const sharpness = parseInt(sharpnessSlider.value);
      
      // Create a copy of original image data
      const imageData = new ImageData(
        new Uint8ClampedArray(originalImageData.data),
        originalImageData.width,
        originalImageData.height
      );
      
      const data = imageData.data;
      
      // Apply brightness and contrast
      const factor = (259 * (contrast - 100 + 255)) / (255 * (259 - (contrast - 100)));
      
      for (let i = 0; i < data.length; i += 4) {
        // Apply brightness
        data[i] = data[i] * brightness / 100;
        data[i + 1] = data[i + 1] * brightness / 100;
        data[i + 2] = data[i + 2] * brightness / 100;
        
        // Apply contrast
        data[i] = factor * (data[i] - 128) + 128;
        data[i + 1] = factor * (data[i + 1] - 128) + 128;
        data[i + 2] = factor * (data[i + 2] - 128) + 128;
      }
      
      // Apply sharpness (simple unsharp mask)
      if (sharpness > 0) {
        const sharpnessData = applySharpness(imageData, sharpness / 100);
        previewCtx.putImageData(sharpnessData, 0, 0);
      } else {
        previewCtx.putImageData(imageData, 0, 0);
      }
    }
    
    // Simple sharpness filter
    function applySharpness(imageData, amount) {
      const width = imageData.width;
      const height = imageData.height;
      const output = new ImageData(width, height);
      const src = imageData.data;
      const dst = output.data;
      
      // Simple sharpen kernel
      const kernel = [
        0, -amount, 0,
        -amount, 1 + 4 * amount, -amount,
        0, -amount, 0
      ];
      
      for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
          const idx = (y * width + x) * 4;
          
          for (let c = 0; c < 3; c++) {
            let sum = 0;
            for (let ky = -1; ky <= 1; ky++) {
              for (let kx = -1; kx <= 1; kx++) {
                const kidx = ((y + ky) * width + (x + kx)) * 4;
                sum += src[kidx + c] * kernel[(ky + 1) * 3 + (kx + 1)];
              }
            }
            dst[idx + c] = Math.max(0, Math.min(255, sum));
          }
          dst[idx + 3] = 255; // Alpha
        }
      }
      
      return output;
    }
    
    // Auto enhance for documents
    function autoEnhance() {
      brightnessSlider.value = 110;
      contrastSlider.value = 130;
      sharpnessSlider.value = 30;
      updateSliderValues();
      applyFilters();
      showStatus('Auto-enhanced for documents', 'success');
    }
    
    // Reset filters
    function resetFilters() {
      brightnessSlider.value = 100;
      contrastSlider.value = 100;
      sharpnessSlider.value = 0;
      updateSliderValues();
      applyFilters();
    }
    
    // Update slider value displays
    function updateSliderValues() {
      document.getElementById('brightness-val').textContent = brightnessSlider.value;
      document.getElementById('contrast-val').textContent = contrastSlider.value;
      document.getElementById('sharpness-val').textContent = sharpnessSlider.value;
    }
    
    // Save document
    function saveDocument() {
      const link = document.createElement('a');
      link.download = `document_${Date.now()}.jpg`;
      link.href = preview.toDataURL('image/jpeg', 0.95);
      link.click();
      showStatus('Document saved!', 'success');
    }
    
    // Show status message
    function showStatus(message, type = '') {
      status.textContent = message;
      status.className = type;
      status.style.display = 'block';
      
      setTimeout(() => {
        status.style.display = 'none';
      }, 3000);
    }
    
    // Event listeners
    captureBtn.addEventListener('click', captureDocument);
    saveBtn.addEventListener('click', saveDocument);
    
    brightnessSlider.addEventListener('input', () => {
      updateSliderValues();
      applyFilters();
    });
    
    contrastSlider.addEventListener('input', () => {
      updateSliderValues();
      applyFilters();
    });
    
    sharpnessSlider.addEventListener('input', () => {
      updateSliderValues();
      applyFilters();
    });
    
    // Initialize
    initCamera();
  </script>
</body>
</html>
